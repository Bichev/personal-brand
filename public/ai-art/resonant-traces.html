<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resonant Traces — Harmonograph & Lissajous Curves</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=EB+Garamond:wght@400;500&family=Crimson+Pro:wght@200;300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --exhibition-black: #0d0d0f;
            --museum-white: #fdfcf8;
            --gold: #c9a55a;
            --silver: #9fa8ab;
            --accent: #c98a5a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', serif;
            background: var(--exhibition-black);
            color: var(--museum-white);
            overflow-x: hidden;
        }

        .exhibition-space {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .exhibition-space::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse at 30% 20%, rgba(30, 22, 18, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(25, 20, 18, 0.3) 0%, transparent 50%);
            pointer-events: none;
        }

        .spotlight {
            position: absolute;
            width: 900px;
            height: 900px;
            background: radial-gradient(circle, rgba(255, 255, 245, 0.03) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }

        #canvas-container {
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 30px 80px rgba(0, 0, 0, 0.9));
        }

        .placard {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            opacity: 0;
            animation: fadeInPlacard 2s 1s forwards;
        }

        @keyframes fadeInPlacard {
            to { opacity: 1; }
        }

        .placard-title {
            font-family: 'EB Garamond', serif;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--accent);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .placard-subtitle {
            font-family: 'Crimson Pro', serif;
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 1px;
            color: var(--silver);
            font-style: italic;
        }

        .placard-meta {
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            font-weight: 200;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.3);
            margin-top: 12px;
        }

        .controls {
            position: absolute;
            top: 40px;
            right: 40px;
            display: flex;
            gap: 16px;
            z-index: 10;
            opacity: 0;
            animation: fadeInControls 1.5s 2s forwards;
        }

        @keyframes fadeInControls {
            to { opacity: 1; }
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(201, 138, 90, 0.3);
            background: rgba(13, 13, 15, 0.7);
            backdrop-filter: blur(10px);
            color: var(--accent);
            font-family: 'Crimson Pro', serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            border-color: var(--accent);
            background: rgba(201, 138, 90, 0.1);
            transform: scale(1.05);
        }

        .seed-display {
            position: absolute;
            top: 40px;
            left: 40px;
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            font-weight: 300;
            letter-spacing: 2px;
            color: rgba(13, 13, 15, 0.7);
            opacity: 0;
            animation: fadeIn 1.5s 2.5s forwards;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 4px;
            backdrop-filter: blur(10px);
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .seed-number {
            font-family: 'Courier New', monospace;
            color: var(--accent);
            margin-left: 8px;
            font-weight: 500;
        }

        .parameters-panel {
            position: absolute;
            left: 40px;
            top: 100px;
            width: 240px;
            opacity: 0;
            animation: fadeIn 1.5s 2.5s forwards;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .param-group {
            margin-bottom: 20px;
        }

        .param-group:last-child {
            margin-bottom: 0;
        }

        .param-label {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            color: #1a1a1a;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .param-value {
            font-family: 'Courier New', monospace;
            font-size: 9px;
            color: var(--accent);
            font-weight: 600;
        }

        .param-slider {
            width: 100%;
            height: 2px;
            background: rgba(201, 138, 90, 0.3);
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 10px;
            height: 10px;
            background: var(--accent);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .param-slider::-moz-range-thumb {
            width: 10px;
            height: 10px;
            background: var(--accent);
            cursor: pointer;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .education-panel {
            position: absolute;
            right: 40px;
            top: 100px;
            width: 280px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            opacity: 0;
            animation: fadeIn 1.5s 3s forwards;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
        }

        .education-panel::-webkit-scrollbar {
            width: 3px;
        }

        .education-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .education-panel::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 2px;
        }

        .edu-section {
            margin-bottom: 12px;
        }

        .edu-header {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 1.5px;
            color: #1a1a1a;
            text-transform: uppercase;
            cursor: pointer;
            padding: 10px 0;
            border-bottom: 1px solid rgba(201, 138, 90, 0.3);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edu-header:hover {
            color: var(--accent);
            border-color: var(--accent);
        }

        .edu-icon {
            font-size: 12px;
            transition: transform 0.3s ease;
            color: var(--accent);
        }

        .edu-header.active .edu-icon {
            transform: rotate(180deg);
        }

        .edu-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 300;
            line-height: 1.7;
            color: #333;
            padding: 0 8px;
        }

        .edu-content.active {
            max-height: 1000px;
            padding: 12px 8px;
        }

        .edu-content p {
            margin-bottom: 8px;
        }

        .edu-content strong {
            color: var(--accent);
            font-weight: 500;
        }

        .edu-content ul {
            margin: 8px 0 8px 16px;
            list-style: none;
        }

        .edu-content li {
            margin-bottom: 4px;
            padding-left: 12px;
            position: relative;
        }

        .edu-content li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'EB Garamond', serif;
            font-size: 14px;
            letter-spacing: 3px;
            color: var(--accent);
            z-index: 5;
        }

        .back-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 10px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            pointer-events: none;
        }

        .back-nav a, .back-nav span {
            pointer-events: auto;
        }

        .back-nav a {
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            letter-spacing: 2px;
            color: var(--accent);
            text-decoration: none;
            opacity: 0.5;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-nav a:hover { opacity: 1; }

        .back-nav .site-name {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            letter-spacing: 3px;
            color: var(--silver);
            opacity: 0.3;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            letter-spacing: 1.5px;
            color: var(--accent);
            opacity: 0.4;
            text-align: center;
        }

        .scroll-arrow {
            animation: bounceArrow 1.5s ease-in-out infinite;
        }

        @keyframes bounceArrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(6px); }
        }

        /* Article section */
        .article-section {
            background: var(--exhibition-black);
            max-width: 720px;
            margin: 0 auto;
            padding: 80px 40px;
        }

        .ornamental-divider {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .ornamental-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--accent);
            opacity: 0.3;
        }

        .ornamental-divider span {
            position: relative;
            background: var(--exhibition-black);
            padding: 0 20px;
            color: var(--accent);
            font-size: 16px;
            opacity: 0.5;
        }

        .article-title {
            font-family: 'EB Garamond', serif;
            font-size: 36px;
            font-weight: 400;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .article-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            font-weight: 300;
            font-size: 18px;
            color: var(--silver);
            margin-bottom: 40px;
        }

        .article-epigraph {
            border-left: 2px solid var(--accent);
            padding: 16px 24px;
            margin-bottom: 48px;
            font-family: 'Crimson Pro', serif;
            font-style: italic;
            font-size: 15px;
            line-height: 1.8;
            color: var(--silver);
        }

        .article-epigraph cite {
            display: block;
            margin-top: 12px;
            font-style: normal;
            font-size: 12px;
            letter-spacing: 1px;
            opacity: 0.6;
        }

        .article-body p {
            font-family: 'Crimson Pro', serif;
            font-size: 16px;
            font-weight: 300;
            line-height: 1.9;
            color: rgba(253, 252, 248, 0.75);
            margin-bottom: 28px;
        }

        .math-box {
            border: 1px solid rgba(201, 138, 90, 0.2);
            padding: 24px;
            margin: 40px 0;
        }

        .math-box-header {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 16px;
        }

        .math-box-formula {
            font-family: 'EB Garamond', serif;
            font-size: 20px;
            color: var(--museum-white);
            margin-bottom: 16px;
        }

        .math-box-description {
            font-family: 'Crimson Pro', serif;
            font-size: 13px;
            font-weight: 300;
            line-height: 1.7;
            color: var(--silver);
        }

        .article-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid rgba(201, 138, 90, 0.15);
        }

        .article-nav a {
            font-family: 'Crimson Pro', serif;
            font-size: 12px;
            letter-spacing: 1.5px;
            color: var(--accent);
            text-decoration: none;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .article-nav a:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="back-nav">
        <a href="/ai-art/">← BACK TO GALLERY</a>
        <span class="site-name">VLADIMIR BICHEV · ALGORITHMIC ART</span>
    </div>

    <div class="exhibition-space" id="top">
        <div class="spotlight"></div>

        <div class="seed-display">
            VARIATION <span class="seed-number" id="seed-display">001</span>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="previousVariation()" title="Previous">←</button>
            <button class="control-btn" onclick="nextVariation()" title="Next">→</button>
            <button class="control-btn" onclick="randomVariation()" title="Random">⟳</button>
        </div>

        <div class="parameters-panel">
            <div class="param-group">
                <div class="param-label">
                    Freq Ratio
                    <span class="param-value" id="freqRatio-value">2.00</span>
                </div>
                <input type="range" class="param-slider" id="freqRatio-slider"
                       min="1" max="4" value="2" step="0.01"
                       oninput="updateParam('freqRatio', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Phase
                    <span class="param-value" id="phase-value">45°</span>
                </div>
                <input type="range" class="param-slider" id="phase-slider"
                       min="0" max="360" value="45" step="1"
                       oninput="updateParam('phase', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Damping
                    <span class="param-value" id="damping-value">0.998</span>
                </div>
                <input type="range" class="param-slider" id="damping-slider"
                       min="0.995" max="1.0" value="0.998" step="0.001"
                       oninput="updateParam('damping', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Amplitude X
                    <span class="param-value" id="ampX-value">250</span>
                </div>
                <input type="range" class="param-slider" id="ampX-slider"
                       min="50" max="350" value="250" step="1"
                       oninput="updateParam('ampX', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Amplitude Y
                    <span class="param-value" id="ampY-value">250</span>
                </div>
                <input type="range" class="param-slider" id="ampY-slider"
                       min="50" max="350" value="250" step="1"
                       oninput="updateParam('ampY', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Draw Speed
                    <span class="param-value" id="speed-value">3</span>
                </div>
                <input type="range" class="param-slider" id="speed-slider"
                       min="1" max="10" value="3" step="1"
                       oninput="updateParam('speed', this.value)">
            </div>
        </div>

        <div class="education-panel">
            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>For 7-Year-Olds</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p>Imagine two swings connected to a pen — as both swings move together, the pen draws beautiful swirly patterns! As the swings slow down, the pattern gets tighter and tighter until the pen finally comes to rest in the center.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>Science</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Harmonograph:</strong> A 19th-century mechanical drawing device that uses coupled pendulums to create intricate patterns. A pen is attached where the pendulums intersect, tracing the combined motion onto paper.</p>
                    <p><strong>Lissajous Figures:</strong> Named after Jules Antoine Lissajous, these curves appear when two perpendicular oscillations are combined. The shape depends entirely on the frequency ratio between the two oscillators.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>Mathematics</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Parametric equations:</strong></p>
                    <ul>
                        <li>x(t) = A₁·sin(f₁·t + φ₁)·e^(-d₁·t)</li>
                        <li>y(t) = A₂·sin(f₂·t + φ₂)·e^(-d₂·t)</li>
                    </ul>
                    <p><strong>Frequency ratios create different patterns:</strong></p>
                    <ul>
                        <li>1:1 — ellipse</li>
                        <li>2:1 — figure-eight</li>
                        <li>3:2 — trefoil</li>
                    </ul>
                    <p>Irrational ratios produce curves that never close, filling space with infinite detail.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>In Nature</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Planetary Orbits:</strong> Lissajous-like paths appear when plotting one planet's position against another — orbital resonances shape the solar system.</p>
                    <p><strong>Coupled Oscillators:</strong> From atoms in crystals to bridges swaying in wind, coupled oscillation is everywhere in physics.</p>
                    <p><strong>Musical Resonance:</strong> Vibrating strings and air columns in instruments produce harmonics governed by the same frequency ratios.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>In Art &amp; Culture</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Spirograph:</strong> The beloved mechanical drawing toy is a direct descendant of the harmonograph principle.</p>
                    <p><strong>Victorian Harmonographs:</strong> In the 1800s, elaborate pendulum machines created drawings displayed in parlors and scientific exhibitions.</p>
                    <p><strong>Sound Visualization:</strong> Oscilloscopes display Lissajous figures when comparing audio signals — making sound visible.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>Philosophy &amp; Meaning</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Harmony as Mathematics:</strong> The same ratios that make musical intervals pleasant (octave = 2:1, fifth = 3:2) create visual harmony in these curves. Beauty is resonance.</p>
                    <p><strong>Beauty as Resonance:</strong> When frequencies align in simple ratios, both ear and eye perceive harmony — suggesting a deep unity between sensory aesthetics and mathematical structure.</p>
                </div>
            </div>
        </div>

        <div id="canvas-container">
            <div class="loading">RENDERING...</div>
        </div>

        <div class="placard">
            <div class="placard-title">Resonant Traces</div>
            <div class="placard-subtitle">Coupled pendulum harmonics and Lissajous figures</div>
            <div class="placard-meta">frequency ratio · damping · phase · harmonic resonance</div>
        </div>

        <div class="scroll-indicator">
            <span>Scroll to read the full article</span>
            <div class="scroll-arrow">↓</div>
        </div>
    </div>

    <div class="article-section">
        <div class="ornamental-divider"><span>◆</span></div>

        <h1 class="article-title">Resonant Traces</h1>
        <p class="article-subtitle">The Geometry of Coupled Oscillation</p>

        <blockquote class="article-epigraph">
            "Music is the arithmetic of sounds as optics is the geometry of light."
            <cite>— Claude Debussy</cite>
        </blockquote>

        <div class="article-body">
            <p>The harmonograph — a 19th-century mechanical device that captured the mathematics of resonance as drawing. Two pendulums, connected through a pen, trace intricate patterns as they swing and slowly decay. What begins as broad, sweeping arcs gradually tightens into a dense, luminous core — the entire history of a dissipating system recorded in a single continuous line.</p>

            <p>The mathematics are parametric equations with damped sinusoidal motion. When frequency ratios are simple — 2:1, 3:2, 4:3 — the patterns are clean and periodic, the pen retracing nearly the same path with each cycle. When ratios are irrational, the pen never retraces its path, creating infinitely complex curves that fill the plane with a density that approaches texture rather than line.</p>

            <p>What the viewer sees is a single line emerging from the edges, slowly building an intricate pattern. As the pendulums lose energy to damping, the pattern tightens inward, creating layers of ever-finer detail. The outermost loops are the youngest — born when the pendulums still held most of their energy. The innermost traces are the oldest, drawn in the final whispered oscillations before stillness.</p>

            <p>Resonance connects music, physics, and visual art through a shared mathematical vocabulary. The frequency ratios that produce harmonious patterns — 2:1, 3:2 — are the same ratios that define musical octaves and fifths. A harmonograph set to a 3:2 ratio draws what a perfect fifth sounds like. Visual harmony and auditory harmony share the same mathematical foundation, suggesting that beauty is not subjective preference but structural resonance.</p>

            <p>These traces are recordings of time. Each point on the curve represents a moment in the pendulums' coupled dance. The pattern is a temporal fossil — the complete history of two oscillating systems, frozen in a single image. Unlike a photograph, which captures an instant, a harmonograph drawing contains every instant, layered together in the order they occurred. It is time made spatial, energy made visible, and decay made beautiful.</p>
        </div>

        <div class="math-box">
            <div class="math-box-header">Damped Harmonic Motion</div>
            <div class="math-box-formula">x(t) = A·sin(f·t + φ)·e<sup>−d·t</sup></div>
            <div class="math-box-description">Amplitude A, frequency f, phase φ, and exponential decay d. Two such equations coupled together — one for x, one for y — produce the harmonograph's infinite variety of curves.</div>
        </div>

        <nav class="article-nav">
            <a href="#top">↑ Return to Exhibit</a>
            <a href="/ai-art/">← Back to Gallery</a>
        </nav>
    </div>

    <script>
        let currentSeed = Math.floor(Math.random() * 999) + 1;
        let params = {
            freqRatio: 2.0,
            phase: 45,
            damping: 0.998,
            ampX: 250,
            ampY: 250,
            speed: 3
        };

        let t = 0;
        let drawing = true;
        let prevX, prevY;
        let seedPhaseX, seedPhaseY, seedFreqOffset;
        let traceGraphics;

        function setup() {
            let canvas = createCanvas(800, 800);
            canvas.parent('canvas-container');
            traceGraphics = createGraphics(800, 800);
            initializeSystem();
            document.querySelector('.loading').style.display = 'none';
        }

        function initializeSystem() {
            randomSeed(currentSeed);

            seedPhaseX = random(-0.5, 0.5);
            seedPhaseY = random(-0.5, 0.5);
            seedFreqOffset = random(-0.03, 0.03);

            t = 0;
            drawing = true;
            prevX = undefined;
            prevY = undefined;

            traceGraphics.background(13, 13, 15);

            updateSeedDisplay();
        }

        function harmonographX(time) {
            let freq = 1.0;
            let phase = radians(params.phase) + seedPhaseX;
            let amp = params.ampX;
            let d = 1.0 - params.damping;
            return amp * sin(freq * time + phase) * exp(-d * time);
        }

        function harmonographY(time) {
            let freq = params.freqRatio + seedFreqOffset;
            let phase = seedPhaseY;
            let amp = params.ampY;
            let d = 1.0 - params.damping;
            return amp * sin(freq * time + phase) * exp(-d * time);
        }

        function draw() {
            image(traceGraphics, 0, 0);

            if (!drawing) return;

            let stepsPerFrame = params.speed * 80;
            let dt = 0.02;

            traceGraphics.strokeWeight(1.0);

            for (let i = 0; i < stepsPerFrame; i++) {
                let cx = width / 2 + harmonographX(t);
                let cy = height / 2 + harmonographY(t);

                if (prevX !== undefined) {
                    let decay = exp(-(1.0 - params.damping) * t);
                    let alpha = map(decay, 0, 1, 20, 200);

                    let r = 201, g = 138, b = 90;
                    r = lerp(r, 170, 1 - decay);
                    g = lerp(g, 120, 1 - decay);
                    b = lerp(b, 85, 1 - decay);

                    traceGraphics.stroke(r, g, b, alpha);
                    traceGraphics.line(prevX, prevY, cx, cy);
                }

                prevX = cx;
                prevY = cy;
                t += dt;

                let currentAmp = max(abs(harmonographX(t)), abs(harmonographY(t)));
                if (currentAmp < 0.3) {
                    drawing = false;
                    break;
                }
            }
        }

        function updateParam(name, value) {
            let numVal = parseFloat(value);
            params[name] = numVal;

            if (name === 'freqRatio') {
                document.getElementById('freqRatio-value').textContent = numVal.toFixed(2);
            } else if (name === 'phase') {
                document.getElementById('phase-value').textContent = numVal + '°';
            } else if (name === 'damping') {
                document.getElementById('damping-value').textContent = numVal.toFixed(3);
            } else if (name === 'speed') {
                document.getElementById('speed-value').textContent = numVal;
            } else {
                document.getElementById(name + '-value').textContent = numVal;
            }

            initializeSystem();
        }

        function updateSeedDisplay() {
            document.getElementById('seed-display').textContent =
                String(currentSeed).padStart(3, '0');
        }

        function previousVariation() {
            currentSeed = Math.max(1, currentSeed - 1);
            initializeSystem();
        }

        function nextVariation() {
            currentSeed = currentSeed + 1;
            initializeSystem();
        }

        function randomVariation() {
            currentSeed = Math.floor(Math.random() * 999) + 1;
            initializeSystem();
        }

        function toggleEdu(header) {
            header.classList.toggle('active');
            header.nextElementSibling.classList.toggle('active');
        }
    </script>
</body>
</html>
