<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellular Worlds — Conway's Game of Life</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=EB+Garamond:wght@400;500&family=Crimson+Pro:wght@200;300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --exhibition-black: #0d0d0f;
            --museum-white: #fdfcf8;
            --gold: #c9a55a;
            --silver: #9fa8ab;
            --accent: #4ade80;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', serif;
            background: var(--exhibition-black);
            color: var(--museum-white);
            overflow-x: hidden;
        }

        .exhibition-space {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .exhibition-space::before {
            content: '';
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse at 30% 20%, rgba(20, 30, 20, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(20, 35, 20, 0.3) 0%, transparent 50%);
            pointer-events: none;
        }

        .spotlight {
            position: absolute;
            width: 900px;
            height: 900px;
            background: radial-gradient(circle, rgba(74, 222, 128, 0.015) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }

        #canvas-container {
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 30px 80px rgba(0, 0, 0, 0.9));
        }

        #canvas-container canvas {
            border: 1px solid rgba(74, 222, 128, 0.12);
        }

        .placard {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            opacity: 0;
            animation: fadeInPlacard 2s 1s forwards;
        }

        @keyframes fadeInPlacard {
            to { opacity: 1; }
        }

        .placard-title {
            font-family: 'EB Garamond', serif;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--accent);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .placard-subtitle {
            font-family: 'Crimson Pro', serif;
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 1px;
            color: var(--silver);
            font-style: italic;
        }

        .placard-meta {
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            font-weight: 200;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.3);
            margin-top: 12px;
        }

        .controls {
            position: absolute;
            top: 40px;
            right: 40px;
            display: flex;
            gap: 16px;
            z-index: 10;
            opacity: 0;
            animation: fadeInControls 1.5s 2s forwards;
        }

        @keyframes fadeInControls {
            to { opacity: 1; }
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(74, 222, 128, 0.3);
            background: rgba(13, 13, 15, 0.7);
            backdrop-filter: blur(10px);
            color: var(--accent);
            font-family: 'Crimson Pro', serif;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            border-color: var(--accent);
            background: rgba(74, 222, 128, 0.1);
            transform: scale(1.05);
        }

        .seed-display {
            position: absolute;
            top: 40px;
            left: 40px;
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            font-weight: 300;
            letter-spacing: 2px;
            color: rgba(13, 13, 15, 0.7);
            opacity: 0;
            animation: fadeIn 1.5s 2.5s forwards;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 4px;
            backdrop-filter: blur(10px);
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .seed-number {
            font-family: 'Courier New', monospace;
            color: #16a34a;
            margin-left: 8px;
            font-weight: 500;
        }

        .gen-display {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Courier New', monospace;
            font-size: 11px;
            font-weight: 300;
            letter-spacing: 2px;
            color: var(--accent);
            opacity: 0;
            animation: fadeIn 1.5s 2.5s forwards;
            z-index: 10;
            text-shadow: 0 0 8px rgba(74, 222, 128, 0.4);
        }

        .parameters-panel {
            position: absolute;
            left: 40px;
            top: 100px;
            width: 240px;
            opacity: 0;
            animation: fadeIn 1.5s 2.5s forwards;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .param-group {
            margin-bottom: 20px;
        }

        .param-label {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 1.5px;
            color: #1a1a1a;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .param-value {
            font-family: 'Courier New', monospace;
            font-size: 9px;
            color: #16a34a;
            font-weight: 600;
        }

        .param-slider {
            width: 100%;
            height: 2px;
            background: rgba(74, 222, 128, 0.3);
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 10px;
            height: 10px;
            background: #16a34a;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .param-slider::-moz-range-thumb {
            width: 10px;
            height: 10px;
            background: #16a34a;
            cursor: pointer;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .pattern-btn {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(74, 222, 128, 0.3);
            background: rgba(255, 255, 255, 0.9);
            color: #1a1a1a;
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 4px;
        }

        .pattern-btn:hover {
            border-color: #16a34a;
            background: rgba(74, 222, 128, 0.08);
        }

        .pattern-name {
            font-weight: 400;
            color: #16a34a;
        }

        .education-panel {
            position: absolute;
            right: 40px;
            top: 100px;
            width: 280px;
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            opacity: 0;
            animation: fadeIn 1.5s 3s forwards;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
        }

        .education-panel::-webkit-scrollbar {
            width: 3px;
        }

        .education-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .education-panel::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 2px;
        }

        .edu-section {
            margin-bottom: 12px;
        }

        .edu-header {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 1.5px;
            color: #1a1a1a;
            text-transform: uppercase;
            cursor: pointer;
            padding: 10px 0;
            border-bottom: 1px solid rgba(74, 222, 128, 0.3);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edu-header:hover {
            color: #16a34a;
            border-color: var(--accent);
        }

        .edu-icon {
            font-size: 12px;
            transition: transform 0.3s ease;
            color: #16a34a;
        }

        .edu-header.active .edu-icon {
            transform: rotate(180deg);
        }

        .edu-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            font-weight: 300;
            line-height: 1.7;
            color: #333;
            padding: 0 8px;
        }

        .edu-content.active {
            max-height: 1000px;
            padding: 12px 8px;
        }

        .edu-content p {
            margin-bottom: 8px;
        }

        .edu-content strong {
            color: #16a34a;
            font-weight: 500;
        }

        .edu-content ul {
            margin: 8px 0 8px 16px;
            list-style: none;
        }

        .edu-content li {
            margin-bottom: 4px;
            padding-left: 12px;
            position: relative;
        }

        .edu-content li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'EB Garamond', serif;
            font-size: 14px;
            letter-spacing: 3px;
            color: var(--accent);
            z-index: 5;
        }

        .back-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 10px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            pointer-events: none;
        }

        .back-nav a, .back-nav span {
            pointer-events: auto;
        }

        .back-nav a {
            font-family: 'Crimson Pro', serif;
            font-size: 11px;
            letter-spacing: 2px;
            color: var(--accent);
            text-decoration: none;
            opacity: 0.5;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .back-nav a:hover { opacity: 1; }

        .back-nav .site-name {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            letter-spacing: 3px;
            color: var(--silver);
            opacity: 0.3;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            animation: pulseGlow 2.5s ease-in-out infinite;
        }
        .scroll-indicator span {
            display: block;
            font-family: 'Crimson Pro', serif;
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .scroll-arrow {
            font-size: 22px;
            display: block;
            animation: bounceArrow 1.5s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        @keyframes bounceArrow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(6px); }
        }

        .article-section {
            background: var(--exhibition-black);
            max-width: 720px;
            margin: 0 auto;
            padding: 80px 40px;
        }

        .ornamental-divider {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .ornamental-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--accent);
            opacity: 0.3;
        }

        .ornamental-divider span {
            position: relative;
            background: var(--exhibition-black);
            padding: 0 20px;
            color: var(--accent);
            font-size: 16px;
            opacity: 0.5;
        }

        .article-title {
            font-family: 'EB Garamond', serif;
            font-size: 36px;
            font-weight: 400;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .article-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            font-weight: 300;
            font-size: 18px;
            color: var(--silver);
            margin-bottom: 40px;
        }

        .article-epigraph {
            border-left: 2px solid var(--accent);
            padding: 16px 24px;
            margin-bottom: 48px;
            font-family: 'Crimson Pro', serif;
            font-style: italic;
            font-size: 15px;
            line-height: 1.8;
            color: var(--silver);
        }

        .article-epigraph cite {
            display: block;
            margin-top: 12px;
            font-style: normal;
            font-size: 12px;
            letter-spacing: 1px;
            opacity: 0.6;
        }

        .article-body p {
            font-family: 'Crimson Pro', serif;
            font-size: 16px;
            font-weight: 300;
            line-height: 1.9;
            color: rgba(253, 252, 248, 0.75);
            margin-bottom: 28px;
        }

        .math-box {
            border: 1px solid rgba(74, 222, 128, 0.25);
            padding: 24px;
            margin: 40px 0;
        }

        .math-box-header {
            font-family: 'Crimson Pro', serif;
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 16px;
        }

        .math-box-formula {
            font-family: 'EB Garamond', serif;
            font-size: 20px;
            color: var(--museum-white);
            margin-bottom: 16px;
        }

        .math-box-description {
            font-family: 'Crimson Pro', serif;
            font-size: 13px;
            font-weight: 300;
            line-height: 1.7;
            color: var(--silver);
        }

        .article-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid rgba(74, 222, 128, 0.15);
        }

        .article-nav a {
            font-family: 'Crimson Pro', serif;
            font-size: 12px;
            letter-spacing: 1.5px;
            color: var(--accent);
            text-decoration: none;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .article-nav a:hover {
            opacity: 1;
        }
    
        /* ── Responsive ── */
        @media (max-width: 1024px) {
            .parameters-panel { left: 20px; top: 80px; width: 180px; }
            .education-panel { right: 20px; top: 80px; width: 200px; }
            .controls { right: 20px; top: 35px; }
            .seed-display { top: 35px; left: 20px; }
        }
        @media (max-width: 768px) {
            .parameters-panel { display: none; }
            .education-panel { display: none; }
            .controls { right: 15px; top: 12px; }
            .controls .control-btn { width: 32px; height: 32px; font-size: 14px; }
            .seed-display { top: 12px; left: 15px; font-size: 9px; }
            .seed-number { font-size: 14px; }
            .back-nav { padding: 8px 15px; }
            .back-nav a { font-size: 9px; letter-spacing: 1px; }
            .back-nav .site-name { display: none; }
            .placard { bottom: 50px; padding: 12px 20px; }
            .placard-title { font-size: 14px; letter-spacing: 3px; }
            .placard-subtitle { font-size: 10px; }
            .placard-meta { font-size: 8px; }
        }
    </style>
</head>
<body>
    <div class="back-nav">
        <a href="/algoart/">← BACK TO GALLERY</a>
        <span class="site-name">VLADIMIR BICHEV · ALGORITHMIC ART</span>
    </div>

    <div class="exhibition-space" id="top">
        <div class="spotlight"></div>

        <div class="seed-display">
            VARIATION <span class="seed-number" id="seed-display">001</span>
        </div>

        <div class="gen-display">
            GEN <span id="gen-counter">0</span>
        </div>

        <div class="controls">
            <button class="control-btn" onclick="previousVariation()" title="Previous">←</button>
            <button class="control-btn" onclick="nextVariation()" title="Next">→</button>
            <button class="control-btn" onclick="randomVariation()" title="Random">⟳</button>
        </div>

        <div class="parameters-panel">
            <div class="param-group">
                <div class="param-label">
                    Grid Size
                    <span class="param-value" id="gridsize-value">100</span>
                </div>
                <input type="range" class="param-slider" id="gridsize-slider"
                       min="40" max="200" value="100" step="10"
                       oninput="updateParam('gridsize', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Speed (FPS)
                    <span class="param-value" id="speed-value">10</span>
                </div>
                <input type="range" class="param-slider" id="speed-slider"
                       min="1" max="30" value="10" step="1"
                       oninput="updateParam('speed', this.value)">
            </div>

            <div class="param-group">
                <div class="param-label">
                    Alive Opacity
                    <span class="param-value" id="opacity-value">0.8</span>
                </div>
                <input type="range" class="param-slider" id="opacity-slider"
                       min="0.3" max="1.0" value="0.8" step="0.05"
                       oninput="updateParam('opacity', this.value)">
            </div>

            <div class="param-group">
                <button class="pattern-btn" onclick="cyclePattern()">
                    Pattern: <span class="pattern-name" id="pattern-name">Random</span>
                </button>
            </div>
        </div>

        <div class="education-panel">
            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>For 7-Year-Olds</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p>Imagine a grid of lights. Each light looks at its 8 neighbors. If a light is off and exactly 3 neighbors are on, it turns on — like being born! If a light is on with 2 or 3 neighbors on, it stays alive. Otherwise it turns off. Watch what happens when millions of lights follow these simple rules!</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>The Science</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>John Conway, 1970.</strong> The Game of Life is a cellular automaton — a grid of cells that evolve through discrete time steps according to simple local rules.</p>
                    <p>It proves that simple local rules can produce <strong>universal computation</strong>. The Game of Life is <strong>Turing complete</strong> — capable of simulating any algorithm that any computer can run.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>Mathematics</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>B3/S23 rule:</strong></p>
                    <ul>
                        <li><strong>Birth</strong> with exactly 3 neighbors</li>
                        <li><strong>Survive</strong> with 2 or 3 neighbors</li>
                        <li><strong>Dead</strong> otherwise</li>
                    </ul>
                    <p>Applied on a 2D grid with <strong>Moore neighborhood</strong> (8 surrounding cells).</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>In Nature</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Crystal growth:</strong> Minerals forming lattice structures from simple bonding rules.</p>
                    <p><strong>Population dynamics:</strong> Birth, death, and carrying capacity in ecosystems.</p>
                    <p><strong>Bacterial colonies:</strong> Growth patterns on petri dishes following local nutrient and neighbor rules.</p>
                    <p><strong>Forest fire spread:</strong> Ignition and extinction based on proximity.</p>
                    <p><strong>Epidemic modeling:</strong> SIR models of disease transmission through local contact.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>In Art &amp; Culture</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Pixel art:</strong> The grid aesthetic of Life inspired an entire generation of digital artists.</p>
                    <p><strong>Generative music:</strong> Mapping cell states to notes creates evolving compositions.</p>
                    <p><strong>Demoscene culture:</strong> Early computer artists pushed hardware limits rendering cellular automata.</p>
                    <p><strong>Computational art pioneer:</strong> Life remains one of the most influential generative systems in digital art history.</p>
                </div>
            </div>

            <div class="edu-section">
                <div class="edu-header" onclick="toggleEdu(this)">
                    <span>Philosophy</span>
                    <span class="edu-icon">▼</span>
                </div>
                <div class="edu-content">
                    <p><strong>Emergence of complexity from simplicity.</strong> Three rules on a flat grid produce structures capable of universal computation.</p>
                    <p><strong>Turing completeness</strong> implies this simple game can simulate ANY computation — logic gates, memory, even a complete computer has been built within the Game of Life.</p>
                    <p>The question: is the universe itself a cellular automaton? Stephen Wolfram and others have pursued this idea seriously.</p>
                </div>
            </div>
        </div>

        <div id="canvas-container">
            <div class="loading">RENDERING...</div>
        </div>

        <div class="placard">
            <div class="placard-title">Cellular Worlds</div>
            <div class="placard-subtitle">Conway's Game of Life and emergent computation</div>
            <div class="placard-meta">B3/S23 · cellular automaton · Turing complete</div>
        </div>

        <div class="scroll-indicator">
            <span>Scroll to read the full article</span>
            <div class="scroll-arrow">↓</div>
        </div>
    </div>

    <div class="article-section">
        <div class="ornamental-divider"><span>◆</span></div>

        <h1 class="article-title">Cellular Worlds</h1>
        <p class="article-subtitle">Emergence, Computation, and the Game of Life</p>

        <blockquote class="article-epigraph">
            "The universe is not only queerer than we suppose, but queerer than we can suppose."
            <cite>— J.B.S. Haldane</cite>
        </blockquote>

        <div class="article-body">
            <p>In 1970, mathematician John Conway devised a simple game with profound implications. On an infinite grid, cells live or die according to three rules based solely on their neighbors. No strategy, no players — just rules. What emerges is nothing short of astonishing.</p>

            <p>The rules — a dead cell with exactly 3 living neighbors is born. A living cell with 2 or 3 neighbors survives. Everything else dies. From this, gliders emerge (structures that walk across the grid), oscillators pulse, and glider guns fire an infinite stream of gliders.</p>

            <p>What the viewer sees — the phosphor-green glow of cellular life evolving on a dark grid. Patterns stabilize, oscillate, or erupt into chaos. Some initial configurations die out entirely, others grow forever. The CRT aesthetic pays homage to the early computers on which Life was first explored.</p>

            <p>The most profound discovery — Conway's Game of Life is Turing complete. It can simulate any computation that any computer can perform. Logic gates, memory, even a complete computer has been built within the Game of Life. A universe capable of computing itself.</p>

            <p>What is the minimum complexity needed for a universe to contain intelligence? Conway showed that astonishingly little is required — a flat grid and three rules. This raises the question: is our own universe, at some level, a cellular automaton?</p>
        </div>

        <div class="math-box">
            <div class="math-box-header">B3/S23</div>
            <div class="math-box-formula">Birth with exactly 3 neighbors. Survival with 2 or 3 neighbors. Death otherwise.</div>
            <div class="math-box-description">Three rules on a 2D grid with 8-cell Moore neighborhood. This minimal ruleset produces Turing-complete computation — capable of simulating any algorithm.</div>
        </div>

        <nav class="article-nav">
            <a href="#top">↑ Return to Exhibit</a>
            <a href="/algoart/">← Back to Gallery</a>
        </nav>
    </div>

    <script>
        let currentSeed = Math.floor(Math.random() * 999) + 1;
        let generation = 0;
        let gridA, gridB;
        let cols, rows;
        let cellSize;
        let scanlineGraphics;
        let patternIndex = 0;
        const patterns = ['Random', 'Glider Gun', 'Pulsar', 'R-pentomino', 'Acorn'];

        let params = {
            gridsize: 100,
            speed: 10,
            opacity: 0.8
        };

        function mulberry32(a) {
            return function() {
                a |= 0; a = a + 0x6D2B79F5 | 0;
                var t = Math.imul(a ^ a >>> 15, 1 | a);
                t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            };
        }

        function setup() {
            let canvas = createCanvas(800, 800);
            canvas.parent('canvas-container');
            pixelDensity(1);
            scanlineGraphics = createGraphics(800, 800);
            drawScanlines();
            initializeSystem();
            document.querySelector('.loading').style.display = 'none';
        }

        function drawScanlines() {
            scanlineGraphics.clear();
            for (let y = 0; y < 800; y += 2) {
                scanlineGraphics.stroke(0, 0, 0, 18);
                scanlineGraphics.line(0, y, 800, y);
            }
        }

        function initializeSystem() {
            cols = params.gridsize;
            rows = params.gridsize;
            cellSize = 800 / cols;
            generation = 0;

            gridA = new Uint8Array(cols * rows);
            gridB = new Uint8Array(cols * rows);

            let patternName = patterns[patternIndex];

            if (patternName === 'Random') {
                let rng = mulberry32(currentSeed);
                for (let i = 0; i < cols * rows; i++) {
                    gridA[i] = rng() < 0.2 ? 1 : 0;
                }
            } else if (patternName === 'Glider Gun') {
                placeGosperGliderGun();
            } else if (patternName === 'Pulsar') {
                placePulsar();
            } else if (patternName === 'R-pentomino') {
                placeRPentomino();
            } else if (patternName === 'Acorn') {
                placeAcorn();
            }

            frameRate(params.speed);
            updateSeedDisplay();
        }

        function placePattern(cx, cy, offsets) {
            gridA.fill(0);
            for (let [dx, dy] of offsets) {
                let x = (cx + dx + cols) % cols;
                let y = (cy + dy + rows) % rows;
                gridA[y * cols + x] = 1;
            }
        }

        function placeGosperGliderGun() {
            let cx = Math.floor(cols / 4);
            let cy = Math.floor(rows / 2);
            let offsets = [
                [0,4],[0,5],[1,4],[1,5],
                [10,4],[10,5],[10,6],[11,3],[11,7],[12,2],[12,8],[13,2],[13,8],
                [14,5],[15,3],[15,7],[16,4],[16,5],[16,6],[17,5],
                [20,2],[20,3],[20,4],[21,2],[21,3],[21,4],[22,1],[22,5],
                [24,0],[24,1],[24,5],[24,6],
                [34,2],[34,3],[35,2],[35,3]
            ];
            placePattern(cx, cy, offsets);
        }

        function placePulsar() {
            let cx = Math.floor(cols / 2);
            let cy = Math.floor(rows / 2);
            let offsets = [];
            let pulsarQuarter = [[2,1],[3,1],[4,1],[1,2],[1,3],[1,4],[6,2],[6,3],[6,4],[2,6],[3,6],[4,6]];
            for (let [x, y] of pulsarQuarter) {
                offsets.push([x, y]);
                offsets.push([-x, y]);
                offsets.push([x, -y]);
                offsets.push([-x, -y]);
            }
            placePattern(cx, cy, offsets);
        }

        function placeRPentomino() {
            let cx = Math.floor(cols / 2);
            let cy = Math.floor(rows / 2);
            placePattern(cx, cy, [[0,-1],[1,-1],[-1,0],[0,0],[0,1]]);
        }

        function placeAcorn() {
            let cx = Math.floor(cols / 2);
            let cy = Math.floor(rows / 2);
            placePattern(cx, cy, [[-3,0],[-2,0],[-2,-2],[0,-1],[1,0],[2,0],[3,0]]);
        }

        function stepSimulation() {
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    let neighbors = 0;
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            if (dx === 0 && dy === 0) continue;
                            let nx = (x + dx + cols) % cols;
                            let ny = (y + dy + rows) % rows;
                            neighbors += gridA[ny * cols + nx];
                        }
                    }
                    let idx = y * cols + x;
                    if (gridA[idx] === 1) {
                        gridB[idx] = (neighbors === 2 || neighbors === 3) ? 1 : 0;
                    } else {
                        gridB[idx] = (neighbors === 3) ? 1 : 0;
                    }
                }
            }
            let tmp = gridA;
            gridA = gridB;
            gridB = tmp;
            generation++;
        }

        function draw() {
            stepSimulation();

            background(10, 10, 12);

            let aliveOpacity = params.opacity * 255;
            let glowR = 74, glowG = 222, glowB = 128;

            noStroke();
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    let px = x * cellSize;
                    let py = y * cellSize;

                    if (gridA[y * cols + x] === 1) {
                        fill(glowR, glowG, glowB, aliveOpacity);
                        rect(px, py, cellSize - 0.5, cellSize - 0.5);

                        if (cellSize > 3) {
                            fill(glowR, glowG, glowB, aliveOpacity * 0.15);
                            rect(px - cellSize * 0.3, py - cellSize * 0.3,
                                 cellSize * 1.6, cellSize * 1.6);
                        }
                    } else {
                        fill(14, 16, 14, 180);
                        rect(px, py, cellSize - 0.5, cellSize - 0.5);
                    }
                }
            }

            image(scanlineGraphics, 0, 0);

            if (random() < 0.3) {
                fill(255, 255, 255, random(1, 3));
                rect(0, 0, 800, 800);
            }

            let vigR = 60;
            drawingContext.save();
            let grad = drawingContext.createRadialGradient(400, 400, 250, 400, 400, 500);
            grad.addColorStop(0, 'rgba(0,0,0,0)');
            grad.addColorStop(1, 'rgba(0,0,0,0.35)');
            drawingContext.fillStyle = grad;
            drawingContext.fillRect(0, 0, 800, 800);
            drawingContext.restore();

            document.getElementById('gen-counter').textContent = generation;
        }

        function updateParam(name, value) {
            let numVal = parseFloat(value);
            params[name] = numVal;

            let displayVal;
            if (name === 'gridsize' || name === 'speed') {
                displayVal = Math.round(numVal);
            } else {
                displayVal = numVal.toFixed(2);
            }
            document.getElementById(name + '-value').textContent = displayVal;

            if (name === 'gridsize') {
                initializeSystem();
            }
            if (name === 'speed') {
                frameRate(numVal);
            }
        }

        function cyclePattern() {
            patternIndex = (patternIndex + 1) % patterns.length;
            document.getElementById('pattern-name').textContent = patterns[patternIndex];
            initializeSystem();
        }

        function updateSeedDisplay() {
            document.getElementById('seed-display').textContent =
                String(currentSeed).padStart(3, '0');
        }

        function previousVariation() {
            currentSeed = Math.max(1, currentSeed - 1);
            initializeSystem();
        }

        function nextVariation() {
            currentSeed = currentSeed + 1;
            initializeSystem();
        }

        function randomVariation() {
            currentSeed = Math.floor(Math.random() * 999) + 1;
            initializeSystem();
        }

        function toggleEdu(header) {
            header.classList.toggle('active');
            header.nextElementSibling.classList.toggle('active');
        }
    </script>
</body>
</html>
